# å¤šæ¨¡å‹ç»Ÿä¸€å¹³å° - API æ–‡æ¡£

## ç‰ˆæœ¬ä¿¡æ¯
**å½“å‰ç‰ˆæœ¬ï¼š** V1.1

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
multi-model-platform-backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                    # FastAPIåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py                  # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ database.py                # æ•°æ®åº“è¿æ¥å’Œä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ dependencies.py            # ä¾èµ–æ³¨å…¥
â”‚   â”œâ”€â”€ middleware.py              # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ exceptions.py              # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                       # APIè·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ v1/                    # APIç‰ˆæœ¬1
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ router.py         # ä¸»è·¯ç”±æ³¨å†Œ
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py           # è®¤è¯ç›¸å…³è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ users.py          # ç”¨æˆ·ç®¡ç†è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ conversations.py  # å¯¹è¯ç®¡ç†è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ models.py         # æ¨¡å‹é…ç½®è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ admin.py          # ç®¡ç†å‘˜è·¯ç”±
â”‚   â”‚   â””â”€â”€ health.py             # å¥åº·æ£€æŸ¥è·¯ç”±
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                      # æ ¸å¿ƒä¸šåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ security.py           # å®‰å…¨ç›¸å…³ï¼ˆJWTã€å¯†ç åŠ å¯†ï¼‰
â”‚   â”‚   â”œâ”€â”€ models.py             # Pydanticæ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ constants.py          # å¸¸é‡å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                  # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth_service.py       # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ user_service.py       # ç”¨æˆ·æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ conversation_service.py  # å¯¹è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ model_service.py      # æ¨¡å‹æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ model_router.py       # æ¨¡å‹è·¯ç”±æœåŠ¡
â”‚   â”‚   â””â”€â”€ admin_service.py      # ç®¡ç†å‘˜æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ repositories/              # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py               # åŸºç¡€Repository
â”‚   â”‚   â”œâ”€â”€ user_repository.py    # ç”¨æˆ·æ•°æ®è®¿é—®
â”‚   â”‚   â”œâ”€â”€ conversation_repository.py  # å¯¹è¯æ•°æ®è®¿é—®
â”‚   â”‚   â”œâ”€â”€ message_repository.py # æ¶ˆæ¯æ•°æ®è®¿é—®
â”‚   â”‚   â”œâ”€â”€ model_repository.py   # æ¨¡å‹é…ç½®æ•°æ®è®¿é—®
â”‚   â”‚   â””â”€â”€ user_model_config_repository.py  # ç”¨æˆ·æ¨¡å‹é…ç½®æ•°æ®è®¿é—®
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                    # SQLAlchemyæ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user.py               # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ conversation.py       # å¯¹è¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ message.py            # æ¶ˆæ¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ system_model.py       # ç³»ç»Ÿæ¨¡å‹é…ç½®
â”‚   â”‚   â””â”€â”€ user_model_config.py  # ç”¨æˆ·æ¨¡å‹é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                   # Pydanticæ¨¡å¼ï¼ˆè¯·æ±‚/å“åº”ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth.py               # è®¤è¯ç›¸å…³æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ user.py               # ç”¨æˆ·ç›¸å…³æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ conversation.py       # å¯¹è¯ç›¸å…³æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ message.py            # æ¶ˆæ¯ç›¸å…³æ¨¡å¼
â”‚   â”‚   â””â”€â”€ model.py              # æ¨¡å‹ç›¸å…³æ¨¡å¼
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ validators.py         # æ•°æ®éªŒè¯å™¨
â”‚   â”‚   â”œâ”€â”€ helpers.py            # è¾…åŠ©å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ logger.py             # æ—¥å¿—é…ç½®
â”‚   â”‚   â””â”€â”€ api_clients/          # ç¬¬ä¸‰æ–¹APIå®¢æˆ·ç«¯
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ base_client.py    # åŸºç¡€APIå®¢æˆ·ç«¯
â”‚   â”‚       â”œâ”€â”€ openai_client.py  # OpenAI APIå®¢æˆ·ç«¯
â”‚   â”‚       â”œâ”€â”€ deepseek_client.py # DeepSeek APIå®¢æˆ·ç«¯
â”‚   â”‚       â””â”€â”€ wenxin_client.py  # æ–‡å¿ƒä¸€è¨€APIå®¢æˆ·ç«¯
â”‚   â”‚
â”‚   â””â”€â”€ tests/                     # æµ‹è¯•ç›®å½•
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ conftest.py           # æµ‹è¯•é…ç½®
â”‚       â”œâ”€â”€ test_auth.py          # è®¤è¯æµ‹è¯•
â”‚       â”œâ”€â”€ test_users.py         # ç”¨æˆ·æµ‹è¯•
â”‚       â”œâ”€â”€ test_conversations.py # å¯¹è¯æµ‹è¯•
â”‚       â””â”€â”€ test_models.py        # æ¨¡å‹æµ‹è¯•
â”‚
â”œâ”€â”€ alembic/                       # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ versions/                  # è¿ç§»ç‰ˆæœ¬
â”‚   â”œâ”€â”€ env.py
â”‚   â””â”€â”€ alembic.ini
â”‚
â”œâ”€â”€ scripts/                       # è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ init_db.py                 # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ create_admin.py            # åˆ›å»ºç®¡ç†å‘˜è„šæœ¬
â”‚   â””â”€â”€ seed_data.py               # ç§å­æ•°æ®è„šæœ¬
â”‚
â”œâ”€â”€ .env                           # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore                     # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ requirements.txt               # Pythonä¾èµ–
â”œâ”€â”€ requirements-dev.txt           # å¼€å‘ä¾èµ–
â”œâ”€â”€ pyproject.toml                 # é¡¹ç›®é…ç½®
â”œâ”€â”€ README.md                      # é¡¹ç›®è¯´æ˜
â””â”€â”€ Dockerfile                     # Dockeré…ç½®ï¼ˆå¯é€‰ï¼‰
```

---

## ğŸ“‹ å†å²ç‰ˆæœ¬åŠæ›´æ–°æ—¥å¿—

### V1.1 (å½“å‰ç‰ˆæœ¬)
**æ›´æ–°æ—¶é—´ï¼š** æœ€æ–°  
**ä¸»è¦æ›´æ–°å†…å®¹ï¼š**
1. **æ–°å¢åŠŸèƒ½**
   - æ·»åŠ äº†æ¶ˆæ¯ï¼ˆMessageï¼‰çš„å®Œæ•´ç®¡ç†æ–¹æ³•å’Œè·¯ç”±
   - å®Œå–„äº†å¯¹è¯ï¼ˆConversationï¼‰çš„ç®¡ç†æ–¹æ³•
   
2. **é…ç½®å˜æ›´**
   - å°†åç«¯æœåŠ¡çš„ç«¯å£ä»é»˜è®¤ç«¯å£è°ƒæ•´ä¸º **8002**ï¼ˆå¯¹å†…å’Œå¯¹å¤–è®¿é—®ï¼‰
   - å°†æ•°æ®åº“æœåŠ¡çš„ç«¯å£è°ƒæ•´ä¸º **3311**ï¼ˆå¯¹å¤–è®¿é—®ï¼‰

3. **å…¶ä»–ä¼˜åŒ–**
   - ä¿®å¤äº†APIæ¥å£ä¸­çš„è‹¥å¹²bug
   - ä¼˜åŒ–äº†é”™è¯¯å¤„ç†æœºåˆ¶

### V1.0
**åˆå§‹ç‰ˆæœ¬**
- å®ç°äº†é¡¹ç›®åŸºç¡€åŠŸèƒ½æ¡†æ¶
- åŒ…æ‹¬ç”¨æˆ·è®¤è¯ã€å¯¹è¯ç®¡ç†ã€æ¨¡å‹é…ç½®ç­‰æ ¸å¿ƒåŠŸèƒ½
- æ­å»ºäº†å®Œæ•´çš„å¤šå±‚æ¶æ„ï¼ˆè·¯ç”±å±‚ã€æœåŠ¡å±‚ã€æ•°æ®è®¿é—®å±‚ï¼‰

---

## ğŸ”§ æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯/åº“ | ç”¨é€” |
|------|---------|------|
| Webæ¡†æ¶ | FastAPI | æ„å»ºRESTful API |
| æ•°æ®åº“ORM | SQLAlchemy | æ•°æ®åº“æ“ä½œ |
| æ•°æ®åº“ | MySQL | æ•°æ®å­˜å‚¨ |
| æ•°æ®éªŒè¯ | Pydantic | è¯·æ±‚/å“åº”æ•°æ®éªŒè¯ |
| èº«ä»½éªŒè¯ | JWT (Python-Jose) | ç”¨æˆ·è®¤è¯ |
| å¯†ç åŠ å¯† | Passlib (bcrypt) | å¯†ç å“ˆå¸Œ |
| é…ç½®ç®¡ç† | Pydantic-settings | ç¯å¢ƒå˜é‡ç®¡ç† |
| å¼‚æ­¥HTTP | HTTPX | APIå®¢æˆ·ç«¯è°ƒç”¨ |
| æ—¥å¿— | Python logging | åº”ç”¨æ—¥å¿— |
| å¼€å‘å·¥å…· | Uvicorn | ASGIæœåŠ¡å™¨ |

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. ç¯å¢ƒè¦æ±‚
- Python 3.8+
- MySQL 5.7+
- pip åŒ…ç®¡ç†å·¥å…·

### 2. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 3. æ•°æ®åº“é…ç½®
1. åˆ›å»ºMySQLæ•°æ®åº“
2. é…ç½® `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯
3. è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼š
```bash
python scripts/init_db.py
```

### 4. å¯åŠ¨åº”ç”¨
```bash
python start_app.py
```
æˆ–
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8002 --reload
```

### 5. è®¿é—®APIæ–‡æ¡£
- **Swagger UI:** http://localhost:8002/docs
- **ReDoc:** http://localhost:8002/redoc

---

## ğŸ“Š API æ¦‚è§ˆ

### è®¤è¯æ¨¡å— (`/api/v1/auth`)
- `POST /login` - ç”¨æˆ·ç™»å½•
- `POST /register` - ç”¨æˆ·æ³¨å†Œ
- `POST /logout` - ç”¨æˆ·ç™»å‡º

### å¯¹è¯ç®¡ç† (`/api/v1/conversations`)
- `GET /` - è·å–å¯¹è¯åˆ—è¡¨
- `POST /` - åˆ›å»ºæ–°å¯¹è¯
- `GET /{id}` - è·å–å¯¹è¯è¯¦æƒ…
- `PUT /{id}` - æ›´æ–°å¯¹è¯
- `DELETE /{id}` - åˆ é™¤å¯¹è¯
- `POST /{id}/archive` - å½’æ¡£å¯¹è¯
- `POST /{id}/unarchive` - å–æ¶ˆå½’æ¡£
- `GET /{id}/messages` - è·å–å¯¹è¯æ¶ˆæ¯
- `POST /{id}/messages` - åˆ›å»ºæ¶ˆæ¯

### æ¨¡å‹ç®¡ç† (`/api/v1/models`)
- `POST /chat` - ä¸å¤§æ¨¡å‹å¯¹è¯
- `GET /available` - è·å–å¯ç”¨æ¨¡å‹
- `POST /config` - é…ç½®ç”¨æˆ·æ¨¡å‹
- `GET /config` - è·å–ç”¨æˆ·é…ç½®
- `GET /usage` - è·å–APIä½¿ç”¨ç»Ÿè®¡

### ç”¨æˆ·ç®¡ç† (`/api/v1/users`)
- `GET /profile` - è·å–ç”¨æˆ·èµ„æ–™
- `PUT /profile` - æ›´æ–°ç”¨æˆ·èµ„æ–™
- `POST /change-password` - ä¿®æ”¹å¯†ç 

### å¥åº·æ£€æŸ¥ (`/health`)
- `GET /` - å¥åº·æ£€æŸ¥ç«¯ç‚¹

---

## ğŸ” èº«ä»½éªŒè¯

æ‰€æœ‰å—ä¿æŠ¤çš„APIç«¯ç‚¹éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦Bearer Tokenï¼š

```
Authorization: Bearer <your_jwt_token>
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

è¯·è”ç³»é‚®ç®±:1552472225@qq.com ç”µè¯ï¼š18767892672

---

*æ–‡æ¡£æœ€åæ›´æ–°ï¼š2025å¹´12æœˆ13æ—¥*